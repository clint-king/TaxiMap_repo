import"./AddressSelection-CWIIN_Gi.js";/* empty css               *//* empty css                 *//* empty css                *//* empty css                        */import"./tonav-BKPMnGmg.js";import"./logout-DBLdyFVo.js";import"./axios-D4YhIzwJ.js";let s=null,a=null;function d(){return localStorage.getItem("userProfile")!==null}function m(){var n,i;if(!d()){console.log("User not authenticated, storing booking data...");const r=sessionStorage.getItem("currentBooking");console.log("Current booking data:",r),r?(sessionStorage.setItem("pendingBookingData",r),console.log("Stored pending booking data for authentication")):console.log("No current booking data found to store"),u();return}const e=sessionStorage.getItem("currentBooking");if(e)try{a=JSON.parse(e),l();return}catch(r){console.error("Error loading current booking from sessionStorage:",r)}const t=localStorage.getItem("paymentData");if(t)try{a=JSON.parse(t),l();return}catch(r){console.error("Error loading booking data:",r),alert("Unable to load booking information. Please try again."),window.location.href="/pages/customer/booking-public.html"}const o=localStorage.getItem("activeTripData");if(o)try{const r=JSON.parse(o);a={routeName:r.routeName,passengers:r.passengers,pricePerPerson:r.pricePerPerson||450,pickupPoints:((n=r.pickupPoints)==null?void 0:n.map(c=>c.address))||[],dropoffPoints:((i=r.dropoffPoints)==null?void 0:i.map(c=>c.address))||[]},l();return}catch(r){console.error("Error loading trip data:",r),alert("Unable to load booking information."),window.location.href="/pages/customer/booking-type-selection.html"}alert("No booking information found. Please start a new booking."),window.location.href="/pages/customer/booking-type-selection.html"}function u(){const e=document.getElementById("payment-content"),t=document.getElementById("payment-success");e&&(e.style.display="none"),t&&(t.style.display="none");const o=document.getElementById("auth-required");o&&(o.style.display="block")}function l(){if(!a)return;const e=a.pricePerPerson||450,t=a.passengers||1,o=e*t;document.getElementById("summary-route").textContent=a.routeName||"-",document.getElementById("summary-passengers").textContent=t,document.getElementById("summary-price-per").textContent=`R${e}`,document.getElementById("summary-total").textContent=`R${o}`;const n="TKS"+Date.now().toString().slice(-8),i=document.getElementById("payment-reference");i&&(i.value=n)}function g(e){s=e,document.querySelectorAll(".payment-method-card").forEach(n=>{n.classList.remove("selected")}),document.querySelectorAll(".payment-form").forEach(n=>{n.classList.remove("show")}),document.querySelector('.payment-method-card[onclick*="'+e+'"]').classList.add("selected");const t=e+"-form",o=document.getElementById(t);o&&o.classList.add("show"),document.getElementById("pay-button").disabled=!1}function p(){if(!s){alert("Please select a payment method");return}if(s==="card"){const t=document.getElementById("card-number").value,o=document.getElementById("card-name").value,n=document.getElementById("card-expiry").value,i=document.getElementById("card-cvv").value;if(!t||!o||!n||!i){alert("Please fill in all card details");return}if(t.replace(/\s/g,"").length<15){alert("Please enter a valid card number");return}}else if(s==="mobile"&&!document.getElementById("mobile-number").value){alert("Please enter your mobile number");return}const e=document.getElementById("pay-button");e.disabled=!0,e.innerHTML='<i class="ri-loader-4-line"></i> Processing Payment...',setTimeout(()=>{y()},2e3)}function y(){if(document.getElementById("payment-content").style.display="none",document.getElementById("payment-success").classList.add("show"),f(),a&&a.bookingId){const t=JSON.parse(localStorage.getItem("userBookings")||"[]"),o=t.findIndex(n=>n.id===a.bookingId);o!==-1&&(t[o].status="paid",t[o].paymentMethod=s,t[o].paymentDate=new Date().toISOString(),localStorage.setItem("userBookings",JSON.stringify(t)))}localStorage.removeItem("activeTripData"),localStorage.removeItem("paymentData");const e={...a,paymentMethod:s,paymentDate:new Date().toISOString(),bookingReference:"TKS"+Date.now().toString().slice(-8)};localStorage.setItem("completedBooking",JSON.stringify(e)),sessionStorage.setItem("currentBooking",JSON.stringify(e)),setTimeout(()=>{window.location.href="booking-confirmation.html"},3e3)}function f(){const e=document.getElementById("vehicle-image-container"),t=document.getElementById("blur-overlay"),o=document.getElementById("vehicle-details");e.classList.add("revealed"),t.classList.add("hidden"),o.classList.add("revealed")}document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("card-number");e&&e.addEventListener("input",function(o){var r;let n=o.target.value.replace(/\s/g,""),i=((r=n.match(/.{1,4}/g))==null?void 0:r.join(" "))||n;o.target.value=i});const t=document.getElementById("card-expiry");t&&t.addEventListener("input",function(o){let n=o.target.value.replace(/\D/g,"");n.length>=2&&(n=n.slice(0,2)+"/"+n.slice(2,4)),o.target.value=n}),m()});function I(){document.getElementById("mobileMenu").classList.toggle("show")}function b(){}window.selectPaymentMethod=g;window.processPayment=p;window.toggleMobileMenu=I;window.topNavZIndexDecrease=b;
