import{a as v}from"./axios-D4YhIzwJ.js";import{B as y}from"./AddressSelection-CWIIN_Gi.js";v.defaults.withCredentials=!0;async function w(){try{await v.post(`${y}/auth/logout`)}catch(e){console.error("Error during logout:",e)}finally{localStorage.removeItem("userProfile"),localStorage.removeItem("userType"),localStorage.removeItem("activityLog"),window.location.href="/index.html"}}function k(){const e=document.querySelector(".nav-links")||document.querySelector(".nav_group");if(e&&!document.getElementById("logoutBtn")){const t=document.createElement("a");t.id="logoutBtn",t.className="nav-logout-btn",t.innerHTML='<i class="fas fa-sign-out-alt"></i> Logout',t.href="#",t.addEventListener("click",async o=>{o.preventDefault(),await w()}),e.appendChild(t)}}function L(){const e=localStorage.getItem("userProfile"),t=document.getElementById("logoutBtn");let o=localStorage.getItem("userType");if(e){if(!o)try{const n=JSON.parse(e);n!=null&&n.user_type&&(o=n.user_type,localStorage.setItem("userType",o))}catch{}const i=n=>p(n);o?i(o):S().then(i).catch(()=>i(null)),t||k()}else t&&t.remove(),p(null)}function C(){return localStorage.getItem("userProfile")?!0:(console.log("User not authenticated, redirecting to home page"),window.location.href="/index.html",!1)}function b(){const e=window.location.pathname,t=document.querySelectorAll(".nav-links a, .nav_group a"),o=localStorage.getItem("userType")||(()=>{try{return JSON.parse(localStorage.getItem("userProfile")||"{}").user_type||null}catch{return null}})(),i=["booking-payment.html","booking-passenger-info.html","booking-trip-info.html","booking-select-transport.html","booking-type-selection.html","booking-public.html","trip-status.html","booking-confirmation.html","booking-edit-locations.html","booking-view-locations.html","booking-passenger-management.html"],n=["owner-dashboard.html","owner-drivers.html","owner-driver-post.html","owner-vehicle-post.html","owner-bookings.html","owner-coverage.html","owner-vehicles.html","owner-portal.html"],h=["driver-dashboard.html","driver-verification.html","driver-trips.html","driver-navigation.html"],d=e.split("/").pop(),u=i.some(r=>d.includes(r)||e.includes(r)),s=n.some(r=>d.includes(r)||e.includes("/Owner/")||e.includes("owner-")),l=h.some(r=>d.includes(r)||e.includes("/driver/")||e.includes("driver-"));let c=null,f=null,g=null;t.forEach(r=>{const a=r.getAttribute("href"),m=r.textContent.trim().toLowerCase();a&&(a.includes("booking-type-selection.html")||m==="book taxi")&&(c=r),o==="owner"&&a&&(a.includes("owner-dashboard.html")||m==="owner dashboard")&&(f=r),a&&(a.includes("driver-dashboard.html")||m==="driver dashboard")&&(g=r)}),t.forEach(r=>{r.classList.remove("active");const a=r.getAttribute("href");if(a){const m=a.split("/").pop();if(s&&o==="owner"&&r===f){r.classList.add("active");return}if(l&&r===g){r.classList.add("active");return}if(u&&r===c){r.classList.add("active");return}(a===e||m===d||a.includes("client.html")&&e.includes("client")&&!e.includes("clientCrowdSource")||a.includes("clientCrowdSource.html")&&e.includes("clientCrowdSource")||a.includes("profile.html")&&e.includes("profile")||a.includes("index.html")&&e.includes("index"))&&r.classList.add("active")}})}document.addEventListener("DOMContentLoaded",()=>{L(),b()});async function S(){var e;try{const t=await fetch(`${y}/auth/profile`,{credentials:"include"});if(!t.ok)throw new Error("Failed to fetch profile");const o=await t.json(),i=((e=o==null?void 0:o.user)==null?void 0:e.user_type)||(o==null?void 0:o.user_type)||null;return i&&localStorage.setItem("userType",i),i}catch(t){return console.warn("Unable to fetch user profile for role:",t),null}}function p(e){const t=document.querySelector(".nav-links")||document.querySelector(".nav_group");if(!t)return;let o=t.querySelector("#fullNav"),i=t.querySelector("#authButtons"),n=t.querySelector("#roleNav");o||(o=document.createElement("div"),o.id="fullNav",o.className="full-navigation",t.appendChild(o)),i||(i=document.createElement("div"),i.id="authButtons",i.className="auth-buttons",t.appendChild(i)),n||(n=document.createElement("div"),n.id="roleNav",t.appendChild(n));const h=(u,s,l)=>{const c=document.createElement("a");return c.href=u,c.textContent=s,l&&(c.className=l),c.setAttribute("onclick","topNavZIndexDecrease && topNavZIndexDecrease()"),c},d=u=>{const s=t.querySelectorAll("a[href]");for(const l of s)if((l.getAttribute("href")||"").endsWith(u))return!0;return!1};if(!e){n&&(n.innerHTML="",n.style.display="none"),i.style.display="block",i.innerHTML="",i.appendChild(h("/pages/authentication/login.html","Login","btn-login")),i.appendChild(h("/pages/authentication/signup.html","Sign Up","btn-signup"));return}i.style.display="none",o.style.display="block",n.innerHTML="",n.style.display="inline-flex",n.style.gap="12px",n.style.alignItems="center",n.style.marginLeft="10px",e==="driver"||e==="owner"?t.querySelectorAll("a").forEach(s=>{const l=s.getAttribute("href"),c=s.textContent.trim().toLowerCase();(l&&(l.includes("booking-type-selection.html")||l.includes("booking-trip-info.html"))||c==="book taxi")&&(s.style.display="none")}):t.querySelectorAll("a").forEach(s=>{const l=s.getAttribute("href"),c=s.textContent.trim().toLowerCase();(l&&(l.includes("booking-type-selection.html")||l.includes("booking-trip-info.html"))||c==="book taxi")&&(s.style.display="")}),e==="driver"?!d("/pages/driver/driver-dashboard.html")&&!d("driver-dashboard.html")&&n.appendChild(h("/pages/driver/driver-dashboard.html","Driver Dashboard")):e==="owner"&&!d("/pages/Owner/owner-dashboard.html")&&!d("owner-dashboard.html")&&n.appendChild(h("/pages/Owner/owner-dashboard.html","Owner Dashboard")),setTimeout(()=>{b()},0)}export{L as c,C as r};
