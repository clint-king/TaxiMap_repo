import{B as u}from"./AddressSelection-CWIIN_Gi.js";import{a as w}from"./sessionHandler-BYiIKMqf.js";import"./axios-D4YhIzwJ.js";class p{constructor(){this.token=this.getTokenFromURL(),this.init()}getTokenFromURL(){const t=new URLSearchParams(window.location.search).get("token");return console.log("Extracted token from URL:",t),t}init(){if(!this.token){this.showError("Invalid or missing reset token. Please request a new password reset link.");return}this.setupEventListeners(),this.setupPasswordStrength()}setupEventListeners(){const e=document.getElementById("resetPasswordForm");e&&e.addEventListener("submit",t=>this.handleResetPassword(t))}setupPasswordStrength(){const e=document.getElementById("newPassword");e&&e.addEventListener("input",t=>{const s=this.checkPasswordStrength(t.target.value),o=document.getElementById("strengthFill"),n=document.getElementById("strengthText");o&&n&&(o.className=`strength-fill ${s}`,n.textContent=s.charAt(0).toUpperCase()+s.slice(1))})}checkPasswordStrength(e){const t=/[a-z]/.test(e),s=/[A-Z]/.test(e),o=/\d/.test(e),n=/[!@#$%^&*(),.?":{}|<>]/.test(e),i=e.length>=8,a=[t,s,o,n,i].filter(Boolean).length;return a<3?"weak":a<4?"fair":a<5?"good":"strong"}async handleResetPassword(e){var d,l,c,g;e.preventDefault();const t=e.target,s=t.newPassword.value,o=t.confirmPassword.value,n=document.getElementById("resetError"),i=document.getElementById("resetBtn"),a=document.getElementById("loading"),m=document.getElementById("successMessage");if(n.textContent="",s!==o){n.textContent="Passwords do not match";return}if(this.checkPasswordStrength(s)==="weak"){n.textContent="Password is too weak. Please choose a stronger password.";return}i.disabled=!0,i.textContent="Resetting...",a.style.display="block";try{console.log("Sending reset password request with token:",this.token),console.log("Password length:",s.length);const r=this.token&&this.token.includes("token=")?this.token.split("token=")[1]:this.token;console.log("Clean token being sent:",r);const h=await w.post(`${u}/auth/reset-password`,{token:r,newPassword:s});h.data.success?(t.style.display="none",a.style.display="none",m.style.display="block",setTimeout(()=>{window.location.href="/pages/authentication/login.html"},3e3)):n.textContent=h.data.message||"Failed to reset password"}catch(r){console.error("Reset password error:",r),((d=r.response)==null?void 0:d.status)===400?n.textContent=r.response.data.message||"Invalid reset token or password":((l=r.response)==null?void 0:l.status)===410?n.textContent="Reset token has expired. Please request a new password reset link.":n.textContent=((g=(c=r.response)==null?void 0:c.data)==null?void 0:g.message)||"Failed to reset password. Please try again."}finally{i.disabled=!1,i.textContent="Reset Password",a.style.display="none"}}showError(e){const t=document.getElementById("resetError"),s=document.getElementById("resetPasswordForm"),o=document.getElementById("successMessage");t&&(t.textContent=e),s&&(s.style.display="none"),o&&(o.style.display="none")}}document.addEventListener("DOMContentLoaded",()=>{new p});
