import"./AddressSelection-CWIIN_Gi.js";import{m as w,f as l,c as m,a as g,t as v,l as S}from"./adminCommon-B1qRNhTn.js";import{r as B}from"./logout-DBLdyFVo.js";import"./axios-D4YhIzwJ.js";let s={},n={};async function E(){L(),await h(),D(),y()}function L(){const e=new Date,t=new Date;t.setDate(t.getDate()-30),document.getElementById("startDate").value=t.toISOString().split("T")[0],document.getElementById("endDate").value=e.toISOString().split("T")[0]}function I(){const e=parseInt(document.getElementById("dateRange").value),t=new Date,a=new Date;a.setDate(a.getDate()-e),document.getElementById("startDate").value=a.toISOString().split("T")[0],document.getElementById("endDate").value=t.toISOString().split("T")[0],f()}async function h(){try{const e=document.getElementById("startDate").value,t=document.getElementById("endDate").value;n=await(await w(`reports?startDate=${e}&endDate=${t}`)).json(),console.log("Report data loaded:",n),p()}catch(e){console.error("Error loading report data:",e),n=$(),p()}}function $(){const e=new Date(document.getElementById("startDate").value),t=new Date(document.getElementById("endDate").value),a=Math.ceil((t-e)/(1e3*60*60*24));return{stats:{totalUsers:1250,newRegistrations:45,activeUsers:320,totalRoutes:180,routeSearches:1250,contributors:25},registrations:u(a,0,10),activeUsers:u(a,50,150),routeSearches:u(a,20,80),activityTypes:[{type:"Route Search",count:1250},{type:"Profile Update",count:320},{type:"Route Contribution",count:45},{type:"Feedback",count:25}],users:T(),routes:R(),topLocations:[{location:"Johannesburg CBD",searches:450},{location:"Cape Town CBD",searches:320},{location:"Durban CBD",searches:280},{location:"Pretoria CBD",searches:200}],peakHours:M(),provinces:[{province:"Gauteng",routes:85,users:450},{province:"Western Cape",routes:45,users:320},{province:"KwaZulu-Natal",routes:35,users:280},{province:"Eastern Cape",routes:15,users:200}]}}function u(e,t,a){const o=[],r=[],i=new Date(document.getElementById("startDate").value);for(let c=0;c<e;c++){const d=new Date(i);d.setDate(d.getDate()+c),r.push(d.toISOString().split("T")[0]),o.push(Math.floor(Math.random()*(a-t+1))+t)}return{labels:r,data:o}}function T(){const e=[],t=["John Doe","Jane Smith","Mike Johnson","Sarah Wilson","David Brown"],a=["john@example.com","jane@example.com","mike@example.com","sarah@example.com","david@example.com"];for(let o=1;o<=50;o++){const r=t[o%t.length],i=a[o%a.length].replace("@",`${o}@`),c=new Date;c.setDate(c.getDate()-Math.floor(Math.random()*365));const d=new Date;d.setDate(d.getDate()-Math.floor(Math.random()*30)),e.push({id:o,name:`${r} ${o}`,email:i,registrationDate:c.toISOString().split("T")[0],lastLogin:d.toISOString().split("T")[0],activityCount:Math.floor(Math.random()*100),routesContributed:Math.floor(Math.random()*5),status:Math.random()>.3?"Active":"Inactive"})}return e}function R(){const e=[],t=["Johannesburg CBD","Cape Town CBD","Durban CBD","Pretoria CBD"],a=["Soweto","Khayelitsha","Umlazi","Mamelodi"],o=["Straight","Loop","Reverse"];for(let r=1;r<=30;r++){const i=new Date;i.setDate(i.getDate()-Math.floor(Math.random()*180)),e.push({id:`R${r.toString().padStart(3,"0")}`,name:`Route ${r}`,startLocation:t[r%t.length],endLocation:a[r%a.length],price:Math.floor(Math.random()*50)+10,type:o[r%o.length],searchCount:Math.floor(Math.random()*100),createdDate:i.toISOString().split("T")[0],contributor:`User ${r}`})}return e}function M(){const e=[];for(let t=0;t<24;t++)e.push({hour:t,searches:Math.floor(Math.random()*50)+(t>=6&&t<=18?20:5)});return e}function p(){const e=n.stats;document.getElementById("totalUsers").textContent=e.totalUsers.toLocaleString(),document.getElementById("newRegistrations").textContent=e.newRegistrations.toLocaleString(),document.getElementById("activeUsers").textContent=e.activeUsers.toLocaleString(),document.getElementById("totalRoutes").textContent=e.totalRoutes.toLocaleString(),document.getElementById("routeSearches").textContent=e.routeSearches.toLocaleString(),document.getElementById("contributors").textContent=e.contributors.toLocaleString()}function D(){x(),U(),k(),A(),H(),O(),F(),j()}function x(){const e=document.getElementById("registrationsChart").getContext("2d");s.registrations=new Chart(e,{type:"line",data:{labels:n.registrations.labels,datasets:[{label:"New Registrations",data:n.registrations.data,borderColor:"#193148",backgroundColor:"rgba(25, 49, 72, 0.1)",tension:.4}]},options:{responsive:!0,scales:{y:{beginAtZero:!0}}}})}function U(){const e=document.getElementById("activeUsersChart").getContext("2d");s.activeUsers=new Chart(e,{type:"bar",data:{labels:n.activeUsers.labels,datasets:[{label:"Active Users",data:n.activeUsers.data,backgroundColor:"#FFD700",borderColor:"#193148",borderWidth:1}]},options:{responsive:!0,scales:{y:{beginAtZero:!0}}}})}function k(){const e=document.getElementById("routeSearchesChart").getContext("2d");s.routeSearches=new Chart(e,{type:"line",data:{labels:n.routeSearches.labels,datasets:[{label:"Route Searches",data:n.routeSearches.data,borderColor:"#28a745",backgroundColor:"rgba(40, 167, 69, 0.1)",tension:.4}]},options:{responsive:!0,scales:{y:{beginAtZero:!0}}}})}function A(){const e=document.getElementById("activityTypesChart").getContext("2d");s.activityTypes=new Chart(e,{type:"doughnut",data:{labels:n.activityTypes.map(t=>t.type),datasets:[{data:n.activityTypes.map(t=>t.count),backgroundColor:["#193148","#FFD700","#28a745","#dc3545"]}]},options:{responsive:!0}})}function H(){const e=document.getElementById("topLocationsChart").getContext("2d");s.topLocations=new Chart(e,{type:"bar",data:{labels:n.topLocations.map(t=>t.location),datasets:[{label:"Searches",data:n.topLocations.map(t=>t.searches),backgroundColor:"#305A84"}]},options:{responsive:!0,scales:{y:{beginAtZero:!0}}}})}function O(){const e=document.getElementById("peakHoursChart").getContext("2d");s.peakHours=new Chart(e,{type:"line",data:{labels:n.peakHours.map(t=>`${t.hour}:00`),datasets:[{label:"Searches per Hour",data:n.peakHours.map(t=>t.searches),borderColor:"#FFD700",backgroundColor:"rgba(255, 215, 0, 0.1)",tension:.4}]},options:{responsive:!0,scales:{y:{beginAtZero:!0}}}})}function F(){const e=document.getElementById("provinceChart").getContext("2d");s.provinces=new Chart(e,{type:"bar",data:{labels:n.provinces.map(t=>t.province),datasets:[{label:"Routes",data:n.provinces.map(t=>t.routes),backgroundColor:"#193148"},{label:"Users",data:n.provinces.map(t=>t.users),backgroundColor:"#FFD700"}]},options:{responsive:!0,scales:{y:{beginAtZero:!0}}}})}function j(){const e=document.getElementById("userLocationChart").getContext("2d");s.userLocation=new Chart(e,{type:"pie",data:{labels:n.provinces.map(t=>t.province),datasets:[{data:n.provinces.map(t=>t.users),backgroundColor:["#193148","#305A84","#FFD700","#28a745"]}]},options:{responsive:!0}})}function y(){b(),C()}function b(){const e=document.getElementById("userTableBody");e.innerHTML="",n.users.forEach(t=>{const a=document.createElement("tr");a.innerHTML=`
      <td>${t.id}</td>
      <td>${t.name}</td>
      <td>${t.email}</td>
      <td>${l(t.registrationDate)}</td>
      <td>${l(t.lastLogin)}</td>
      <td>${t.activityCount}</td>
      <td>${t.routesContributed}</td>
      <td>${m(t.status)}</td>
    `,e.appendChild(a)})}function C(){const e=document.getElementById("routeTableBody");e.innerHTML="",n.routes.forEach(t=>{const a=document.createElement("tr");a.innerHTML=`
      <td>${t.id}</td>
      <td>${t.name}</td>
      <td>${t.startLocation}</td>
      <td>${t.endLocation}</td>
      <td>${g(t.price)}</td>
      <td>${t.type}</td>
      <td>${t.searchCount}</td>
      <td>${l(t.createdDate)}</td>
      <td>${t.contributor}</td>
    `,e.appendChild(a)})}async function f(){await h(),Object.values(s).forEach(e=>{e&&e.destroy&&e.destroy()}),D(),y()}function Z(){const e=document.getElementById("userSort").value;n.users.sort((t,a)=>e==="registrationDate"||e==="lastLogin"?new Date(a[e])-new Date(t[e]):a[e]-t[e]),b()}function J(){const e=document.getElementById("userFilter").value;let t=n.users;if(e==="active"){const o=new Date;o.setDate(o.getDate()-7),t=n.users.filter(r=>new Date(r.lastLogin)>o)}else if(e==="inactive"){const o=new Date;o.setDate(o.getDate()-30),t=n.users.filter(r=>new Date(r.lastLogin)<o)}else e==="contributors"&&(t=n.users.filter(o=>o.routesContributed>0));const a=document.getElementById("userTableBody");a.innerHTML="",t.forEach(o=>{const r=document.createElement("tr");r.innerHTML=`
      <td>${o.id}</td>
      <td>${o.name}</td>
      <td>${o.email}</td>
      <td>${l(o.registrationDate)}</td>
      <td>${l(o.lastLogin)}</td>
      <td>${o.activityCount}</td>
      <td>${o.routesContributed}</td>
      <td>${m(o.status)}</td>
    `,a.appendChild(r)})}function P(){const e=document.getElementById("routeSort").value;n.routes.sort((t,a)=>e==="createdDate"?new Date(a[e])-new Date(t[e]):a[e]-t[e]),C()}function N(){const e=document.getElementById("routeFilter").value;let t=n.routes;if(e==="popular")t=n.routes.filter(o=>o.searchCount>50);else if(e==="recent"){const o=new Date;o.setDate(o.getDate()-7),t=n.routes.filter(r=>new Date(r.createdDate)>o)}else e==="expensive"&&(t=n.routes.filter(o=>o.price>30));const a=document.getElementById("routeTableBody");a.innerHTML="",t.forEach(o=>{const r=document.createElement("tr");r.innerHTML=`
      <td>${o.id}</td>
      <td>${o.name}</td>
      <td>${o.startLocation}</td>
      <td>${o.endLocation}</td>
      <td>${g(o.price)}</td>
      <td>${o.type}</td>
      <td>${o.searchCount}</td>
      <td>${l(o.createdDate)}</td>
      <td>${o.contributor}</td>
    `,a.appendChild(r)})}function W(){const e={stats:n.stats,users:n.users,routes:n.routes,exportDate:new Date().toISOString()},t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),a=URL.createObjectURL(t),o=document.createElement("a");o.href=a,o.download=`teksimap-reports-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(a)}window.toggleAdminMobileMenu=v;window.logout=S;window.updateDateRange=I;window.updateReports=f;window.sortUserTable=Z;window.filterUserTable=J;window.sortRouteTable=P;window.filterRouteTable=N;window.exportReports=W;document.addEventListener("DOMContentLoaded",()=>{B(),E()});
