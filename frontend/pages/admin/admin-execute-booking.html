<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Execute Booking - Admin - TeksiMap</title>
  <link rel="stylesheet" href="../../css/adminStyle.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    .card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      margin-bottom: 1.5rem;
    }

    .card-header {
      padding: 1.5rem;
      border-bottom: 2px solid #e9ecef;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .card-header h2 {
      margin: 0;
      color: #01386A;
      font-size: 1.25rem;
    }

    .card-body {
      padding: 1.5rem;
    }

    .info-group {
      margin-bottom: 1rem;
    }

    .info-group label {
      display: block;
      font-weight: 600;
      color: #666;
      margin-bottom: 0.25rem;
      font-size: 0.9rem;
    }

    .info-group p {
      margin: 0;
      color: #333;
      font-size: 1rem;
    }

    .status-badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 12px;
      font-size: 0.85rem;
      font-weight: 600;
      text-transform: capitalize;
    }

    .status-badge.active {
      background: #28a745;
      color: white;
    }

    .status-badge.inactive {
      background: #6c757d;
      color: white;
    }

    .status-badge.verified {
      background: #17a2b8;
      color: white;
    }

    .status-badge.pending {
      background: #ffc107;
      color: #333;
    }

    .badge {
      display: inline-block;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
      color: white;
    }

    .btn-lg {
      padding: 1rem 2rem;
      font-size: 1.1rem;
    }

    .btn-success {
      background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
      color: white;
    }

    .btn-success:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
    }
  </style>
</head>
<body>
  <!-- Admin Navigation -->
  <nav class="admin-nav">
    <div class="nav-container">
      <div class="logo">
        <a href="admin.html">
          <img src="../../assets/icons/logo-advanced-white.svg" alt="TeksiMap Logo" class="h-10 w-auto" />
        </a>
        <span class="admin-badge">Admin</span>
      </div>

      <!-- Burger button for mobile -->
      <div class="burger" onclick="toggleAdminMobileMenu()">
        <div class="bar"></div>
        <div class="bar"></div>
        <div class="bar"></div>
      </div>

      <!-- Navigation links -->
      <div class="nav-links" id="adminMobileMenu">
        <a href="admin.html">Taxi Ranks</a>
        <a href="route.html">Routes</a>
        <a href="admin-reports.html">Reports</a>
        <a href="admin-pending.html">Pending Routes</a>
        <a href="admin-feedback.html">Feedback</a>
        <a href="admin-contributors.html">Contributors</a>
        <a href="admin-existing-routes.html">Existing Routes</a>
        <a href="admin-vehicles.html">Vehicles</a>
        <a href="admin-drivers.html">Drivers</a>
        <a href="admin-execute-booking.html" class="active">Execute Booking</a>
        <a href="../customer/client.html" class="user-link">User View</a>
        <a href="#" onclick="logout()" class="logout-link">Logout</a>
      </div>
    </div>
  </nav>

  <div class="admin-dashboard">
    <div class="admin-section">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
        <div>
          <h1><i class="fas fa-calendar-check"></i> Execute Booking</h1>
          <p style="color: #666; margin-top: 0.5rem;">Select a route and execute a booking with the next vehicle in queue</p>
        </div>
        <a href="admin.html" class="btn btn-secondary">
          <i class="fas fa-arrow-left"></i> Back to Dashboard
        </a>
      </div>

      <!-- Loading State -->
      <div id="loadingState" style="text-align: center; padding: 3rem;">
        <i class="fas fa-spinner fa-spin" style="font-size: 3rem; color: #01386A; margin-bottom: 1rem;"></i>
        <p>Loading routes...</p>
      </div>

      <!-- Error State -->
      <div id="errorState" style="display: none; text-align: center; padding: 3rem; color: #dc3545;">
        <i class="fas fa-exclamation-circle" style="font-size: 3rem; margin-bottom: 1rem;"></i>
        <p id="errorMessage">Failed to load data</p>
        <button class="btn btn-primary" onclick="location.reload()" style="margin-top: 1rem;">
          <i class="fas fa-sync-alt"></i> Retry
        </button>
      </div>

      <!-- Booking Form -->
      <div id="bookingForm" style="display: none;">
        <!-- Route Selection -->
        <div class="card" style="margin-bottom: 2rem;">
          <div class="card-header">
            <h2><i class="fas fa-route"></i> Select Route</h2>
          </div>
          <div class="card-body">
            <div class="form-group">
              <label for="routeSelect">Existing Route *</label>
              <select id="routeSelect" class="form-control" required>
                <option value="">-- Select a Route --</option>
              </select>
            </div>
            <button class="btn btn-primary" onclick="loadNextVehicle()" id="loadVehicleBtn" disabled>
              <i class="fas fa-search"></i> View Next Vehicle in Queue
            </button>
          </div>
        </div>

        <!-- Next Vehicle in Queue -->
        <div id="nextVehicleSection" class="card" style="margin-bottom: 2rem; display: none;">
          <div class="card-header">
            <h2><i class="fas fa-car"></i> Next Vehicle in Queue (Position 1)</h2>
            <span class="badge" style="background: #28a745;">Next in Line</span>
          </div>
          <div class="card-body">
            <div id="nextVehicleInfo">
              <!-- Vehicle and driver info will be displayed here -->
            </div>
          </div>
        </div>

        <!-- Booking Details -->
        <div id="bookingDetailsSection" class="card" style="margin-bottom: 2rem; display: none;">
          <div class="card-header">
            <h2><i class="fas fa-calendar"></i> Booking Details</h2>
          </div>
          <div class="card-body">
            <form id="executeBookingForm">
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                <div class="form-group">
                  <label for="scheduledPickup">Scheduled Pickup Date & Time *</label>
                  <input type="datetime-local" id="scheduledPickup" class="form-control" required>
                </div>
                <div class="form-group">
                  <label for="passengerCount">Passenger Count</label>
                  <input type="number" id="passengerCount" class="form-control" min="0" value="0">
                </div>
                <div class="form-group">
                  <label for="parcelCount">Parcel Count</label>
                  <input type="number" id="parcelCount" class="form-control" min="0" value="0">
                </div>
              </div>
              <div class="form-group" style="margin-top: 1.5rem;">
                <label for="specialInstructions">Special Instructions</label>
                <textarea id="specialInstructions" class="form-control" rows="3" placeholder="Optional special instructions for this booking"></textarea>
              </div>
              <div style="margin-top: 2rem;">
                <button type="submit" class="btn btn-success btn-lg" id="executeBookingBtn">
                  <i class="fas fa-check-circle"></i> Execute Booking
                </button>
                <button type="button" class="btn btn-secondary" onclick="resetForm()" style="margin-left: 1rem;">
                  <i class="fas fa-redo"></i> Reset
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script type="module" src="../../js/admin/adminExecuteBooking.js"></script>
  <script type="module" src="../../js/authentication/logout.js"></script>
  <script type="module" src="../../js/admin/adminCommon.js"></script>

  <script>
    // Navigation functions
    function toggleAdminMobileMenu() {
      const menu = document.getElementById('adminMobileMenu');
      menu.classList.toggle('show');
    }

    window.toggleAdminMobileMenu = toggleAdminMobileMenu;
  </script>

</body>
</html>

