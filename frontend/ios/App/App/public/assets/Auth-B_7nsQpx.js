import{a as y}from"./axios-D4YhIzwJ.js";import{B as b}from"./AddressSelection-CWIIN_Gi.js";import{c as L}from"./logout-DBLdyFVo.js";y.defaults.withCredentials=!0;const h=document.querySelector(".signupName"),v=document.querySelector(".signupEmail"),p=document.querySelector(".signupPassword"),S=document.querySelector(".signupConfirm"),P=document.querySelector(".signupSubmit"),C=document.querySelector(".loginEmail"),x=document.querySelector(".loginPassword"),B=document.querySelector(".loginSubmit"),E=new URLSearchParams(window.location.search),k=E.get("return");console.log("Page loaded - URL return parameter:",k);if(k==="payment"){const o=sessionStorage.getItem("currentBooking");console.log("Return=payment detected, current booking:",o),o&&!sessionStorage.getItem("pendingBookingData")&&(sessionStorage.setItem("pendingBookingData",o),console.log("Set pending booking data from current booking"))}P&&P.addEventListener("click",async o=>{var g,i;if(o.preventDefault(),h.value.trim()===""||v.value.trim()===""||p.value.trim()===""||S.value.trim()==="")return alert("Fill in all inputs");if(p.value!==S.value)return console.log("Passwords do not match"),alert("Passwords do not match");const e=document.getElementById("loadingOverlay"),a=document.querySelector(".signupSubmit"),n=document.querySelector(".loading-text");e&&e.classList.add("show"),a&&(a.disabled=!0,a.textContent="Creating Account..."),setTimeout(()=>{n&&(n.textContent="Setting up your profile...")},1e3);try{const r=await y.post(`${b}/auth/signup`,{name:h.value,email:v.value.trim(),password:p.value});h.value="",v.value="",p.value="",S.value="",r.data.autoVerified?alert("Registration successful! Email verification was skipped for development. You can now log in."):r.data.emailSent?alert("Registration successful! Please check your email to verify your account before logging in."):alert("Registration successful! However, we couldn't send the verification email. Please contact support.");const l=sessionStorage.getItem("pendingBookingData");window.location.href="/pages/authentication/login.html"}catch(r){const l=document.getElementById("loadingOverlay"),d=document.querySelector(".signupSubmit");l&&l.classList.remove("show"),d&&(d.disabled=!1,d.textContent="Sign Up"),console.error(r);const m=((i=(g=r.response)==null?void 0:g.data)==null?void 0:i.message)||"Signup failed. Check your details or try again.";alert(m)}});B&&B.addEventListener("click",async o=>{var i,r,l,d,m,s,f;o.preventDefault();const e=document.querySelector(".loginError");if(e&&(e.textContent=""),C.value.trim()===""||x.value.trim()===""){e&&(e.textContent="Please fill in all inputs");return}const a=document.getElementById("loadingOverlay"),n=document.querySelector(".loginSubmit"),g=document.querySelector(".loading-text");a&&a.classList.add("show"),n&&(n.classList.add("loading"),n.disabled=!0,n.textContent="Logging in..."),setTimeout(()=>{g&&(g.textContent="Verifying credentials...")},1e3);try{const t=await y.post(`${b}/auth/login`,{email:C.value.trim(),password:x.value},{withCredentials:!0}),c=t.data.user_type;t.data.user&&localStorage.setItem("userProfile",JSON.stringify(t.data.user)),c&&localStorage.setItem("userType",c),L();const u=sessionStorage.getItem("pendingBookingData");console.log("Login successful - checking for pending booking data:",u),console.log("URL parameters:",window.location.search),console.log("Return parameter:",E.get("return")),c==="admin"?window.location.href="/pages/admin/admin.html":c==="client"?u?(sessionStorage.setItem("currentBooking",u),sessionStorage.removeItem("pendingBookingData"),console.log("Redirecting to payment page with restored booking data"),window.location.href="/pages/customer/booking-payment.html"):k==="payment"?(console.log("Return=payment detected but no pending data, redirecting to payment page anyway"),window.location.href="/pages/customer/booking-payment.html"):(console.log("No pending booking data found, redirecting to client page"),window.location.href="/pages/customer/client.html"):c==="driver"?window.location.href="/pages/driver/driver-dashboard.html":c==="owner"?window.location.href="/pages/Owner/owner-dashboard.html":e&&(e.textContent="Unknown user type.")}catch(t){const c=document.getElementById("loadingOverlay"),u=document.querySelector(".loginSubmit");if(c&&c.classList.remove("show"),u&&(u.classList.remove("loading"),u.disabled=!1,u.textContent="Login"),console.error(t),((i=t==null?void 0:t.response)==null?void 0:i.status)===403&&((l=(r=t==null?void 0:t.response)==null?void 0:r.data)!=null&&l.emailNotVerified)){const w=t.response.data.message;e&&(e.textContent=w)}else if(((d=t==null?void 0:t.response)==null?void 0:d.status)===401||((m=t==null?void 0:t.response)==null?void 0:m.status)===400)e&&(e.textContent="Email or password is wrong");else{const w=((f=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:f.message)||"Login failed. Please try again.";e&&(e.textContent=w)}}});const I=()=>{const o=document.querySelector(".verification-help");o&&o.classList.add("show")};window.showResendVerification=I;const D=()=>{const o=document.getElementById("forgotPasswordModal"),e=document.getElementById("forgotPasswordForm"),a=document.querySelector(".forgot-password-success"),n=document.querySelector(".forgotPasswordError");e.style.display="block",a.style.display="none",n.textContent="",e.reset(),o.style.display="block"},q=()=>{const o=document.getElementById("forgotPasswordModal");o.style.display="none"},R=async o=>{var r,l,d,m;o.preventDefault();const e=o.target,a=e.email.value.trim(),n=document.querySelector(".forgotPasswordError"),g=document.querySelector(".forgot-password-success"),i=e.querySelector(".reset-password-btn");if(n.textContent="",!a){n.textContent="Please enter your email address";return}i.disabled=!0,i.textContent="Sending...";try{const s=await y.post(`${b}/auth/forgot-password`,{email:a});if(s.data.success){if(e.style.display="none",g.style.display="block",s.data.developmentMode&&s.data.resetUrl){const f=document.querySelector(".forgot-password-success p");f&&(f.innerHTML=`
            âœ… Reset link generated successfully!<br>
            <strong>Development Mode:</strong> Click the link below to reset your password:<br>
            <a href="${s.data.resetUrl}" target="_blank" style="color: #FFD737; text-decoration: underline;">
              ${s.data.resetUrl}
            </a>
          `)}}else n.textContent=s.data.message||"Failed to send reset link"}catch(s){console.error("Forgot password error:",s),((r=s.response)==null?void 0:r.status)===404?n.textContent="Email address not found. Please check your email or sign up.":((l=s.response)==null?void 0:l.status)===429?n.textContent="Too many requests. Please wait a few minutes before trying again.":n.textContent=((m=(d=s.response)==null?void 0:d.data)==null?void 0:m.message)||"Failed to send reset link. Please try again."}finally{i.disabled=!1,i.textContent="Send Reset Link"}};window.showForgotPassword=D;window.closeForgotPasswordModal=q;document.addEventListener("DOMContentLoaded",()=>{const o=document.getElementById("forgotPasswordForm");o&&o.addEventListener("submit",R);const e=document.getElementById("forgotPasswordModal");e&&e.addEventListener("click",a=>{a.target===e&&q()})});
