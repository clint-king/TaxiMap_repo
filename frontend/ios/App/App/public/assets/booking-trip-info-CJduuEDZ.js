import"./AddressSelection-CWIIN_Gi.js";/* empty css                *//* empty css                    *//* empty css               */import"./tonav-BKPMnGmg.js";import"./logout-DBLdyFVo.js";import"./axios-D4YhIzwJ.js";function P(){document.querySelector(".nav-links").classList.toggle("show")}function S(){const e=document.querySelector(".topnav");e&&(e.style.zIndex="999")}let l,c=[],i=[],s=null;document.addEventListener("DOMContentLoaded",function(){console.log("DOM Content Loaded"),k(),D(),O(),r()});function k(){if(console.log("Initializing booking map..."),typeof google>"u"||!google.maps){setTimeout(k,100);return}l=new google.maps.Map(document.getElementById("bookingMap"),{center:{lat:-26.2,lng:28.5},zoom:8,mapTypeId:"roadmap",restriction:{latLngBounds:{north:-22,south:-35,west:16,east:33},strictBounds:!1}}),console.log("Map initialized successfully"),new google.maps.Geocoder,new google.maps.places.PlacesService(l)}function D(){document.getElementById("addPickupPoint").addEventListener("click",b),document.getElementById("tripInfoForm").addEventListener("submit",F),document.getElementById("clearMarkers").addEventListener("click",w),document.getElementById("centerMap").addEventListener("click",x);const e=document.getElementById("destination"),t=document.getElementById("destinationSuggestions");e.addEventListener("input",()=>{console.log("Destination input changed:",e.value),p(t,e.value)});const n=document.querySelector('input[name="pickup[]"]'),o=document.getElementById("pickupSuggestions1");console.log("First pickup input found:",n),console.log("First pickup suggestions found:",o),n&&o&&n.addEventListener("input",()=>{console.log("Pickup input changed:",n.value),p(o,n.value)}),document.getElementById("passengerCount").addEventListener("input",r),document.getElementById("departureDate").addEventListener("change",E),document.getElementById("returnDate").addEventListener("change",E)}async function p(e,t){if(console.log("fetchSuggestions called with:",t,"for element:",e),!t){e.innerHTML="";return}if(typeof google>"u"||!google.maps||!google.maps.places){setTimeout(()=>p(e,t),100);return}new google.maps.places.AutocompleteService().getPlacePredictions({input:t,componentRestrictions:{country:"za"},types:["geocode"]},(o,d)=>{if(d!==google.maps.places.PlacesServiceStatus.OK||!o){e.innerHTML="";return}console.log("Received suggestions:",o.length),e.innerHTML="",o.forEach(u=>{const a=document.createElement("li");a.textContent=u.description,a.style.padding="10px",a.style.cursor="pointer",a.style.borderBottom="1px solid #eee",a.style.backgroundColor="#fff",a.style.transition="background-color 0.2s",a.addEventListener("mouseenter",()=>{a.style.backgroundColor="#f0f0f0"}),a.addEventListener("mouseleave",()=>{a.style.backgroundColor="#fff"}),a.addEventListener("click",()=>{new google.maps.places.PlacesService(l).getDetails({placeId:u.place_id},(m,L)=>{if(L===google.maps.places.PlacesServiceStatus.OK&&m.geometry){const g=m.geometry.location.lng(),f=m.geometry.location.lat();if(console.log("Selected coordinates:",g,f),e.id==="destinationSuggestions")M(u.description,g,f),document.getElementById("destination").value=u.description,e.innerHTML="";else{const v=parseInt(e.id.replace("pickupSuggestions",""))-1;C(u.description,g,f,v);const y=document.querySelector(`input[name="pickup[]"]:nth-of-type(${v+1})`);y&&(y.value=u.description),e.innerHTML=""}}})}),e.appendChild(a)})})}function M(e,t,n){s&&s.setMap(null),s=new google.maps.Marker({position:{lat:n,lng:t},map:l,icon:{path:google.maps.SymbolPath.CIRCLE,scale:10,fillColor:"#dc3545",fillOpacity:1,strokeColor:"#ffffff",strokeWeight:3},title:"Destination"}),l.panTo({lat:n,lng:t}),l.setZoom(12),r()}function C(e,t,n,o){c[o]&&c[o].setMap(null),c[o]=new google.maps.Marker({position:{lat:n,lng:t},map:l,icon:{path:google.maps.SymbolPath.CIRCLE,scale:10,fillColor:"#28a745",fillOpacity:1,strokeColor:"#ffffff",strokeWeight:3},title:"Pickup Point"}),i[o]={address:e,lng:t,lat:n,index:o},l.panTo({lat:n,lng:t}),l.setZoom(12),r()}function b(){const e=i.length,t={address:"",lng:null,lat:null,index:e};i.push(t),I("",e),h()}function I(e,t){const n=document.getElementById("pickupPointsList"),o=document.createElement("div");o.className="pickup-point-item",o.innerHTML=`
        <div class="input-group">
            <label>Pickup Point ${t+1}</label>
            <div class="input-with-icon">
                <input type="text" name="pickup[]" placeholder="Search for pickup address" value="${e}" required>
                <span class="input-icon">üìç</span>
            </div>
            <ul id="pickupSuggestions${t+1}" class="suggestions-dropdown"></ul>
        </div>
        <button type="button" class="remove-pickup">Remove</button>
    `,n.appendChild(o);const d=o.querySelector("input"),u=o.querySelector(".remove-pickup"),a=o.querySelector(`#pickupSuggestions${t+1}`);d.addEventListener("input",()=>{p(a,d.value)}),u.addEventListener("click",()=>T(t)),h()}function T(e){i.splice(e,1),c[e]&&(c[e].setMap(null),c.splice(e,1)),B(),r()}function B(){const e=document.getElementById("pickupPointsList");e.innerHTML="",i.forEach((t,n)=>{I(t.address,n)})}function h(){document.querySelectorAll(".remove-pickup").forEach(t=>{t.style.display=i.length>1?"block":"none"})}function w(){c.forEach(e=>e.setMap(null)),s&&s.setMap(null),c=[],s=null,i=[],document.getElementById("destination").value="",B(),r()}function x(){if(s&&i.length>0){const e=new google.maps.LatLngBounds,t=s.getPosition();e.extend(t),i.forEach(n=>{n.lng&&n.lat&&e.extend({lat:n.lat,lng:n.lng})}),l.fitBounds(e)}else l.panTo({lat:-26.2041,lng:28.0473}),l.setZoom(12)}function O(){const e=new Date,t=new Date(e.getTime()+24*60*60*1e3);document.getElementById("departureDate").value=t.toISOString().split("T")[0],document.getElementById("departureTime").value="08:00"}function E(){const e=document.getElementById("departureDate").value,t=document.getElementById("returnDate").value;t&&t<e&&(alert("Return date must be after departure date"),document.getElementById("returnDate").value="")}function r(){const e=document.getElementById("passengerCount").value;document.getElementById("passengerSummary").textContent=e,document.getElementById("pickupCount").textContent=i.length,s&&i.length>0&&R()}function R(){const e=Math.floor(Math.random()*50)+10,t=Math.floor(e/30*60);document.getElementById("estimatedDistance").textContent=`${e} km`,document.getElementById("estimatedDuration").textContent=`${t} minutes`}function F(e){if(e.preventDefault(),!H())return;const t={destination:document.getElementById("destination").value,pickupPoints:i.map(n=>({address:n.address,lng:n.lng,lat:n.lat})),passengerCount:parseInt(document.getElementById("passengerCount").value),departureDate:document.getElementById("departureDate").value,departureTime:document.getElementById("departureTime").value,returnDate:document.getElementById("returnDate").value||null,returnTime:document.getElementById("returnTime").value||null,maxDistance:parseFloat(document.getElementById("maxDistance").value)};sessionStorage.setItem("tripInfo",JSON.stringify(t)),window.location.href="/pages/customer/booking-select-transport.html"}function H(){const e=document.getElementById("destination").value.trim(),t=parseInt(document.getElementById("passengerCount").value),n=document.getElementById("departureDate").value,o=document.getElementById("departureTime").value;return e?s?i.length===0?(alert("Please add at least one pickup point"),!1):t<1?(alert("Please enter a valid number of passengers"),!1):!n||!o?(alert("Please select departure date and time"),!1):!0:(alert("Please select a destination on the map"),!1):(alert("Please enter a destination"),!1)}window.toggleMobileMenu=P;window.topNavZIndexDecrease=S;
